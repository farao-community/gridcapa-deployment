kind: ConfigMap
apiVersion: v1
metadata:
  name: gridcapa-postgresql-configmap
  labels:
    app: gridcapa
    component: postgresql
data:
  init.sh: |-
    #!/bin/bash

    psql << EOF
    CREATE DATABASE config_server_db;
    CREATE USER $POSTGRES_CONFIG_USER WITH ENCRYPTED PASSWORD '$POSTGRES_CONFIG_PASSWORD';
    GRANT ALL PRIVILEGES ON DATABASE config_server_db TO $POSTGRES_CONFIG_USER;
    CREATE DATABASE cse_idcc_tasks;
    CREATE USER $POSTGRES_CSE_IDCC_USER WITH ENCRYPTED PASSWORD '$POSTGRES_CSE_IDCC_PASSWORD';
    GRANT ALL PRIVILEGES ON DATABASE cse_idcc_tasks TO $POSTGRES_CSE_IDCC_USER;
    CREATE DATABASE cse_d2cc_tasks;
    CREATE USER $POSTGRES_CSE_D2CC_USER WITH ENCRYPTED PASSWORD '$POSTGRES_CSE_D2CC_PASSWORD';
    GRANT ALL PRIVILEGES ON DATABASE cse_d2cc_tasks TO $POSTGRES_CSE_D2CC_USER;
    CREATE DATABASE core_valid_tasks;
    CREATE USER $POSTGRES_CORE_VALID_USER WITH ENCRYPTED PASSWORD '$POSTGRES_CORE_VALID_PASSWORD';
    GRANT ALL PRIVILEGES ON DATABASE core_valid_tasks TO $POSTGRES_CORE_VALID_USER;
    CREATE DATABASE cse_valid_d2cc_tasks;
    CREATE USER $POSTGRES_CSE_VALID_D2CC_USER WITH ENCRYPTED PASSWORD '$POSTGRES_CSE_VALID_D2CC_PASSWORD';
    GRANT ALL PRIVILEGES ON DATABASE cse_valid_d2cc_tasks TO $POSTGRES_CSE_VALID_D2CC_USER;
    CREATE DATABASE cse_valid_idcc_tasks;
    CREATE USER $POSTGRES_CSE_VALID_IDCC_USER WITH ENCRYPTED PASSWORD '$POSTGRES_CSE_VALID_IDCC_PASSWORD';
    GRANT ALL PRIVILEGES ON DATABASE cse_valid_idcc_tasks TO $POSTGRES_CSE_VALID_IDCC_PASSWORD;
    EOF