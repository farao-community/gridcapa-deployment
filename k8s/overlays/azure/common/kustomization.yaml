apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

bases:
  - ../../../common

resources:
  - azure-storage-class.yaml
  - minio-pv-claim.yaml
  - postgresql-configmap.yaml
  - postgresql-deployment.yaml
  - postgresql-pv-claim.yaml
  - postgresql-service.yaml

patches:
  - patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: gridcapa-minio
      spec:
        template:
          spec:
            volumes:
              - name: gridcapa-minio-data
                persistentVolumeClaim:
                  claimName: gridcapa-minio-storage
  - patch: |-
      apiVersion: apps/v1
      kind: StatefulSet
      metadata:
        name: gridcapa-rabbitmq
      spec:
        volumeClaimTemplates:
          - metadata:
              name: gridcapa-rabbitmq-data
            spec:
              storageClassName: azure-storage-class
              accessModes:
                - ReadWriteOnce
              resources:
                requests:
                  storage: "3Gi"