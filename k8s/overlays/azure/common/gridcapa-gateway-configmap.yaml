kind: ConfigMap
apiVersion: v1
metadata:
  name: gateway-configmap
  labels:
    app: gridcapa
    component: gateway-configmap
data:
  application.yml: |-
    server:
      port: 8080
      ssl:
        enabled: false
    
    spring:
      security:
        oauth2:
          resourceserver:
            jwt:
              jwk-set-uri: https://auth.farao-community.com/auth/realms/GridCapa/protocol/openid-connect/certs
              issuer-uri: https://auth.farao-community.com/auth/realms/GridCapa
      cloud:
        gateway:
          routes:
            - id: core-valid-gridsuite-config
              uri: http://config-server
              predicates:
                - Path=/core/valid/config/**
              filters:
                - StripPrefix=3
                - AddRequestHeader=userId, johnDoe
            - id: core-valid-gridsuite-config-notification
              uri: http://config-notification-server
              predicates:
                - Path=/core/valid/config-notification/**
              filters:
                - StripPrefix=3
                - AddRequestHeader=userId, johnDoe
                - RemoveRequestParameter=access_token
            - id: core-valid-task-manager
              uri: http://core-valid-task-manager
              predicates:
                - Path=/core/valid/task-manager/**
              filters:
                - StripPrefix=3
            - id: core-valid-task-notification-server
              uri: http://core-valid-task-notification-server
              predicates:
                - Path=/core/valid/task-notification/**
              filters:
                - StripPrefix=3
                - RemoveRequestParameter=access_token
            - id: core-valid-gridcapa-job-launcher
              uri: http://core-valid-gridcapa-job-launcher
              predicates:
                - Path=/core/valid/gridcapa-job-launcher/**
              filters:
                - StripPrefix=3
            - id: cse-d2cc-gridsuite-config
              uri: http://config-server
              predicates:
                - Path=/cse/d2cc/config/**
              filters:
                - StripPrefix=3
                - AddRequestHeader=userId, johnDoe
            - id: cse-d2cc-gridsuite-config-notification
              uri: http://config-notification-server
              predicates:
                - Path=/cse/d2cc/config-notification/**
              filters:
                - StripPrefix=3
                - AddRequestHeader=userId, johnDoe
                - RemoveRequestParameter=access_token
            - id: cse-d2cc-task-manager
              uri: http://cse-d2cc-task-manager
              predicates:
                - Path=/cse/d2cc/task-manager/**
              filters:
                - StripPrefix=3
            - id: cse-d2cc-task-notification-server
              uri: http://cse-d2cc-task-notification-server
              predicates:
                - Path=/cse/d2cc/task-notification/**
              filters:
                - StripPrefix=3
                - RemoveRequestParameter=access_token
            - id: cse-d2cc-gridcapa-job-launcher
              uri: http://cse-d2cc-gridcapa-job-launcher
              predicates:
                - Path=/cse/d2cc/gridcapa-job-launcher/**
              filters:
                - StripPrefix=3
            - id: apps-metadata-server
              uri: http://apps-metadata-server
              predicates:
                - Path=/apps-metadata/**
              filters:
                - StripPrefix=1
