kind: ConfigMap
apiVersion: v1
metadata:
  name: gridcapa-postgresql-configmap
  labels:
    app: gridcapa
    component: postgresql
data:
  init.sh: |-
    #!/bin/bash

    psql << EOF
    CREATE DATABASE config_server_db;
    CREATE USER $POSTGRES_CONFIG_USER WITH ENCRYPTED PASSWORD '$POSTGRES_CONFIG_PASSWORD';
    GRANT ALL PRIVILEGES ON DATABASE config_server_db TO $POSTGRES_CONFIG_USER;

    CREATE DATABASE cse_export_idcc_tasks;
    CREATE USER $POSTGRES_CSE_EXPORT_IDCC_USER WITH ENCRYPTED PASSWORD '$POSTGRES_CSE_EXPORT_IDCC_PASSWORD';
    GRANT ALL PRIVILEGES ON DATABASE cse_export_idcc_tasks TO $POSTGRES_CSE_EXPORT_IDCC_USER;
    CREATE DATABASE cse_export_d2cc_tasks;
    CREATE USER $POSTGRES_CSE_EXPORT_D2CC_USER WITH ENCRYPTED PASSWORD '$POSTGRES_CSE_EXPORT_D2CC_PASSWORD';
    GRANT ALL PRIVILEGES ON DATABASE cse_export_d2cc_tasks TO $POSTGRES_CSE_EXPORT_D2CC_USER;
    CREATE DATABASE swe_d2cc_tasks;
    CREATE USER $POSTGRES_SWE_D2CC_USER WITH ENCRYPTED PASSWORD '$POSTGRES_SWE_D2CC_PASSWORD';
    GRANT ALL PRIVILEGES ON DATABASE swe_d2cc_tasks TO $POSTGRES_SWE_D2CC_USER;
    CREATE DATABASE swe_idcc_tasks;
    CREATE USER $POSTGRES_SWE_IDCC_USER WITH ENCRYPTED PASSWORD '$POSTGRES_SWE_IDCC_PASSWORD';
    GRANT ALL PRIVILEGES ON DATABASE swe_idcc_tasks TO $POSTGRES_SWE_IDCC_USER;
    CREATE DATABASE cse_import_ec_idcc_tasks;
    CREATE USER $POSTGRES_CSE_IMPORT_EC_IDCC_USER WITH ENCRYPTED PASSWORD '$POSTGRES_CSE_IMPORT_EC_IDCC_PASSWORD';
    GRANT ALL PRIVILEGES ON DATABASE cse_import_ec_idcc_tasks TO $POSTGRES_CSE_IMPORT_EC_IDCC_USER;
    CREATE DATABASE cse_import_ec_d2cc_tasks;
    CREATE USER $POSTGRES_CSE_IMPORT_EC_D2CC_USER WITH ENCRYPTED PASSWORD '$POSTGRES_CSE_IMPORT_EC_D2CC_PASSWORD';
    GRANT ALL PRIVILEGES ON DATABASE cse_import_ec_d2cc_tasks TO $POSTGRES_CSE_IMPORT_EC_D2CC_USER;
    EOF