version: "3.7"
services:
  core-valid-day-ahead-conservative-app:
    image: farao/gridcapa-app:latest
    volumes:
      - ../common/config/env.json:/usr/local/apache2/htdocs/gridcapa/env.json:Z
      - ./config/core-process-metadata.json:/usr/local/apache2/htdocs/gridcapa/process-metadata.json:Z
    networks:
      - gridcapa

  core-valid-day-ahead-conservative-data-bridge:
    image: farao/gridcapa-data-bridge:latest
    volumes:
      - ./config/core-valid-day-ahead-conservative-data-bridge-application.yml:/config/application.yml
    networks:
      - gridcapa

  core-valid-day-ahead-conservative-task-manager:
    image: test_iva_taskmgr:latest
    volumes:
      - ./config/core-valid-day-ahead-conservative-task-manager-application.yml:/config/application.yml
      - ./config/data.sql:/config/data.sql
    networks:
      - gridcapa

  core-valid-day-ahead-conservative-job-launcher:
    image: farao/gridcapa-job-launcher:latest
    env_file:
      - ../common/config/version.env
    volumes:
      - ./config/core-valid-day-ahead-conservative-job-launcher-application.yml:/config/application.yml
    networks:
      - gridcapa

  core-valid-day-ahead-conservative-runner:
    image: test_iva_app:latest
    volumes:
      - ./config/core-valid-day-ahead-conservative-runner-application.yml:/config/application.yml
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8080/actuator/health" ]
      interval: 30s
      timeout: 30s
      retries: 5
    networks:
      - gridcapa

  core-valid-day-ahead-conservative-adapter:
    image: test_iva_adapter:latest
    env_file:
      - ../common/config/version.env
    volumes:
      - ./config/core-valid-day-ahead-conservative-adapter-application.yml:/config/application.yml
    healthcheck:
      test: [ "CMD", "wget", "-O", "-", "http://localhost:8080/actuator/health" ]
      interval: 30s
      timeout: 30s
      retries: 5
    networks:
      - gridcapa

  core-valid-day-ahead-conservative-output-data-bridge:
    image: farao/gridcapa-output-data-bridge:latest
    volumes:
      - ./config/core-valid-day-ahead-conservative-output-data-bridge-application.yml:/config/application.yml
    healthcheck:
      test: [ "CMD", "wget", "-O", "-", "http://localhost:8080/actuator/health" ]
      interval: 30s
      timeout: 30s
      retries: 5
    networks:
      - gridcapa

  core-valid-day-ahead-conservative-post-processing:
    image: test_iva_postproc:latest
    volumes:
      - ./config/core-valid-day-ahead-conservative-post-processing-application.yml:/config/application.yml
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8080/actuator/health" ]
      interval: 30s
      timeout: 30s
      retries: 5
    networks:
      - gridcapa

networks:
  gridcapa:
    name: gridcapa
