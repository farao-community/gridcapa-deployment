name: Release job

on:
  push:
    branches:
      - add_release_job

  workflow_dispatch:
    inputs:
      releaseVersion:
        description: 'Release version'
        required: false
        default: 1.0.0 #todo remove and set required
      environment:
        description: 'Environment (coreso/azure)'
        required: false
        default: azure #todo remove and set required
      namespace:
        description: 'Namespace (dev/test/prod)'
        required: false
        default: dev #todo remove and set required

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Change  version of gridcapa app to release version
        uses: jossef/action-set-json-field@v2.1
        with:
          file: test-file.json
          field: version
          value: 1.0.0

      - name: Commit and tag release version
        uses: stefanzweifel/git-auto-commit-action@master
        with:
          branch: release-v${{ github.event.inputs.releaseVersion }}
          create_branch: true
          commit_message: Prepare release ${{ github.event.inputs.releaseVersion }} for ${{ github.event.inputs.environment }}-${{ github.event.inputs.namespace }}
          tagging_message: v${{ github.event.inputs.releaseVersion }}-${{ github.event.inputs.environment }}-${{ github.event.inputs.namespace }}